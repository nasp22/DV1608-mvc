FROM ubuntu

ARG DEBIAN_FRONTEND=noninteractive
RUN apt-get update \ 
    && apt-get install -y --no-install-recommends \
        gpg \
        gpg-agent \
        software-properties-common \
    && LC_ALL=C.UTF-8 add-apt-repository ppa:ondrej/php \
    && apt-get update \ 
    && apt-get install -y --no-install-recommends \
        apache2 \
        libapache2-mod-php8.2 \
        git \
        curl \
        make \
        php8.2 \
        php8.2-cli \
        php8.2-curl \
        php8.2-intl \
        php8.2-gd \
        php8.2-mbstring \
        php8.2-mysql \
        php8.2-opcache \
        php8.2-sqlite3 \
        php8.2-xdebug \
        php8.2-xml \
        php8.2-zip \
    && rm -rf /var/lib/apt/lists/*

RUN git config --global user.email "you@example.com" \
    && git config --global user.name "Your Name"

#COPY 000-default.conf /etc/apache2/sites-available/000-default.conf
RUN a2enmod rewrite expires cgi setenvif

COPY --from=composer:latest /usr/bin/composer /usr/local/bin/composer

WORKDIR /build/symfony
RUN curl -sS https://get.symfony.com/cli/installer | bash \
    && mv /root/.symfony5/bin/symfony /usr/local/bin/symfony \
    && rm -f /tmp/*

WORKDIR /home/dbw
CMD ["apachectl", "-D", "FOREGROUND"]
